# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ÆKassa

## üìã –®–∞–≥–∏ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –ÆKassa

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://yookassa.ru
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ
3. –°–æ–∑–¥–∞–π—Ç–µ –º–∞–≥–∞–∑–∏–Ω

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π

1. –ó–∞–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–ú–∞–≥–∞–∑–∏–Ω**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **shopId** (ID –º–∞–≥–∞–∑–∏–Ω–∞)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É **API** ‚Üí **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
4. –°–æ–∑–¥–∞–π—Ç–µ **Secret Key** (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á)
5. ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ Secret Key - –æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```env
YOOKASSA_SHOP_ID=–≤–∞—à_shop_id
YOOKASSA_SECRET_KEY=–≤–∞—à_secret_key
NEXT_PUBLIC_SITE_URL=https://snovaniel.ru
```

**–ü—Ä–∏–º–µ—Ä:**
```env
YOOKASSA_SHOP_ID=123456
YOOKASSA_SECRET_KEY=live_AbCdEfGhIjKlMnOpQrStUvWxYz1234567890
NEXT_PUBLIC_SITE_URL=https://snovaniel.ru
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –≤ –ÆKassa

1. –ó–∞–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
2. –í–∫–ª—é—á–∏—Ç–µ **HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
3. –£–∫–∞–∂–∏—Ç–µ URL: `https://snovaniel.ru/api/payment/webhook`
4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è:
   - ‚úÖ `payment.succeeded` (—É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞)
   - ‚úÖ `payment.canceled` (–æ—Ç–º–µ–Ω–∞ –æ–ø–ª–∞—Ç—ã)
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

### 5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cd /home/ecocraft-store
npm install
npm run prisma:migrate
npm run prisma:generate
npm run build
pm2 restart ecocraft
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º

–ÆKassa –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ **—Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ** –ø–æ–∫–∞ –≤—ã –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ.

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã:**
- **–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞**: `5555 5555 5555 4477`
- **–û—Ç–∫–ª–æ–Ω—ë–Ω–Ω–∞—è –æ–ø–ª–∞—Ç–∞**: `5555 5555 5555 5511`
- **–î–∞—Ç–∞**: –ª—é–±–∞—è –±—É–¥—É—â–∞—è
- **CVC**: –ª—é–±—ã–µ 3 —Ü–∏—Ñ—Ä—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
2. –û—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑
3. –ù–∞–∂–º–∏—Ç–µ "–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ"
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ:
   - ‚úÖ –ü–ª–∞—Ç—ë–∂ —Å–æ–∑–¥–∞—ë—Ç—Å—è
   - ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ÆKassa —Ä–∞–±–æ—Ç–∞–µ—Ç
   - ‚úÖ –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞ success —Å—Ç—Ä–∞–Ω–∏—Ü—É
   - ‚úÖ Webhook –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
   - ‚úÖ –í –∞–¥–º–∏–Ω–∫–µ –≤–∏–¥–µ–Ω —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `/admin/orders`
2. –ù–∞–π–¥–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "SUCCEEDED")
4. –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞—Ç—å "CONFIRMED"

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–∏ –∫–ª—é—á–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `pm2 logs ecocraft`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `YOOKASSA_SHOP_ID` –∏ `YOOKASSA_SECRET_KEY` –∑–∞–¥–∞–Ω—ã

### –ü—Ä–æ–±–ª–µ–º–∞: "Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ÆKassa: `https://snovaniel.ru/api/payment/webhook`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `pm2 logs ecocraft | grep webhook`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS

### –ü—Ä–æ–±–ª–µ–º–∞: "–°—Ç–∞—Ç—É—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –ø—Ä–∏—Ö–æ–¥—è—Ç –ª–∏ webhook: `pm2 logs ecocraft | grep "Webhook"`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ webhook –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤—ã–±—Ä–∞–Ω—ã –Ω—É–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `orderId` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ metadata –ø–ª–∞—Ç–µ–∂–∞

## üì± –ë–æ–µ–≤–æ–π —Ä–µ–∂–∏–º

–ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –≤ –ÆKassa:

1. ‚úÖ –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
2. ‚úÖ –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –ÆKassa
3. ‚úÖ –°–º–µ–Ω–∏—Ç–µ –∫–ª—é—á–∏ –Ω–∞ –±–æ–µ–≤—ã–µ (–µ—Å–ª–∏ –æ–Ω–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å)
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ–π
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —á–µ–∫–∏ (54-–§–ó) –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cat .env | grep YOOKASSA

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –ø–ª–∞—Ç–µ–∂–µ–π
pm2 logs ecocraft | grep payment

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook
pm2 logs ecocraft | grep webhook

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
pm2 restart ecocraft
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` –≤ Git!**

‚úÖ Secret Key –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è webhook
‚úÖ –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ–¥–ø–∏—Å—å webhook –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ÆKassa**: https://yookassa.ru/developers
**–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞**: https://yookassa.ru/support
**–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã**: https://status.yookassa.ru

